<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Карта кофеен</title>
  <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
    }
    #map {
      width: 100%;
      height: 100%;
    }
    /* Чтобы убрать двойные полосы прокрутки в бабле */
    .ymaps-2-1-79-balloon__content {
      overflow: hidden !important;
    }
    .balloon-body {
      max-height: 200px;
      overflow-y: auto;
    }
    .balloon-body img, 
    .balloon-body iframe {
      max-width: 100%;
      height: auto;
      display: block;
    }
  </style>
</head>
<body>
<div id="map"></div>

<script>
ymaps.ready(init);

let map;

function init() {
  // Создаём карту
  map = new ymaps.Map("map", {
    center: [59.93, 30.34],
    zoom: 12,
    controls: ['zoomControl', 'geolocationControl']
  });

  // Кофейня 1
  const coffee1 = new ymaps.Placemark([59.911946, 30.316499], {
    balloonContentHeader: "Tour Coffee",
    balloonContentBody: `
      <div class="balloon-body">
        <p>Tour coffee — это предвкушение каждый раз чего-то нового: разные сорта, разные обжарщики. Интересно пробовать и знать, что приготовят его хорошо.</p>
        <p>Здесь подают шикарные гриль-чизы и свежие десерты. И конечно же вкусный кофе.</p>
         <iframe src="https://t.me/teplo_coffeeroutes/4?embed=1"
          width="100%" height="300"
          frameborder="0" scrolling="no"></iframe>
      </div>
    `,
    balloonContentFooter: '7-я Красноармейская ул., 5Д'
  }, { preset: 'islands#icon', iconColor: '#b84114' });

  // Кофейня 2
  const coffee2 = new ymaps.Placemark([59.960012, 30.311556], {
    balloonContentHeader: "UNIC",
    balloonContentBody: `
      <div class="balloon-body">
        <p>UNIC — место, куда хочется приходить — за вкусной едой, кофе и разговором с теми, кто по-настоящему увлечён своим делом.</p>
        <iframe src="https://t.me/teplo_coffeeroutes/8?embed=1"
          width="100%" height="300"
          frameborder="0" scrolling="no"></iframe>
      </div>
    `,
    balloonContentFooter: 'ул. Кронверская, 12'
  }, { preset: 'islands#icon', iconColor: '#ff4500' });

  map.geoObjects.add(coffee1);
  map.geoObjects.add(coffee2);

  // Определение геопозиции
  locateUser();
}

function locateUser() {
  ymaps.geolocation.get({
    provider: 'browser',
    mapStateAutoApply: false
  }).then(function (res) {
    const coords = res.geoObjects.get(0).geometry.getCoordinates();
    addUserMarker(coords);
  }, function (err) {
    console.error("Ошибка геолокации:", err);
  });
}

function addUserMarker(coords) {
  const userMarker = new ymaps.Placemark(coords, {
    balloonContent: 'Вы здесь'
  }, {
    preset: 'islands#circleIcon',
    iconColor: '#3399ff'
  });
  map.geoObjects.add(userMarker);
  map.setCenter(coords, 14, { duration: 500 });
}
</script>
</body>
</html>
